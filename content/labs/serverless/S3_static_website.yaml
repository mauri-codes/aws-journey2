lab: S3_static_website
info:
  title: S3 Static Website
  location: "serverless"
overview:
  description: >
    You can use Amazon S3 to host a static website. Static websites don't need an active
    server and are generally cheaper. In this lab you'll build a public static website
    with https configuration.
  goals:
    - Create an S3 bucket and configure it to host a static website
    - Upload files to S3 bucket (index.html)
    - Create a Cloudfront Distribution to allow HTTPS requests to your S3 bucket
  services:
    - S3
    - CloudFront
  resources:
    - resource: S3 Bucket
      text: bucket for the static website
      conditions:
        - name: tagged
          value: "s3-website"
    - resource: Cloudfront Distribution
      text: Distribution that allows HTTPS connections
      conditions:
        - name: startsWith
          value: "journey-"
testData:
  tag: "s3-website"
  permissions:
    - s3:GetBucketWebsite
    - s3:GetBucketPolicyStatus
    - s3:GetBucketPublicAccessBlock
    - cloudfront:GetDistribution
    - cloudfront:ListDistributions
    - cloudfront:ListTagsForResource
  testParams:
    - s3BucketName
    - region
testGroups:
  - id: S3BucketTests
    title: S3 Website Bucket Configuration
    tests:
      - id: BucketPolicyIsPublic
        errors:
          - code: NoSuchBucketPolicy
            message: No Bucket Policy Found
      - id: BucketWebsiteConfiguration
        errors:
          - code: NoSuchWebsiteConfiguration
            message: No Website Configuration Found
          - code: _MissingIndexErrorDocuments
            message: No Index or Error Files Configured in Website Configuration
      - id: AccessBlockIsPublic
      - id: BucketWebsiteEndpointOperational
        errors:
          - code: "403"
            message: "S3 Website endpoint not availble, Forbidden 403"
  - id: CloudFrontTests
    title: CloudFront Distribution Configuration
    tests:
      - id: DistributionHasHTTPSDefaultConfiguration
        errors:
          - code: _CloudFrontNotDefaultCertificate
            message: CloudFront is not the default Certificate Source for distribution
      - id: DistributionHasS3WebsiteOrigin
        errors:
          - code: _NoS3WebsiteDomainInCloudFront
            message: No origin with S3 website endpoint found
    errors:
      - code: _NoDistributionList
        message: No distribution configuration found
      - code: _TooManyDistributions
        message: You have more than 10 distributions in your account
      - code: _NoTaggedDistribution
        message: No distribution found with tag [journey, s3-website]
      - code: _OnlyOneTaggedDistributtionAllowed
        message: You should only have one distribution tagged with [journey, s3-website]
